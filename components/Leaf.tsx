import React, {useEffect, useState} from 'react';
import styled from 'styled-components';

import {Size} from '../hooks/useElementSize';
import {Point} from '../hooks/useLeafPoints';

const Board = styled.div<{size: Size}>`
  overflow: visible;
  margin-left: 120px;
  margin-top: 160px;
  width: ${(props) => props.size.width}px;
  height: ${(props) => props.size.height}px;
  position: absolute;
  top: 0;
  left: 0;
`;

const bouquets = [
  //

  [
    <>
      <path
        d="M56.72 93.59C57.4 88.42 54 85.52 50 82.28s-4.62-2.68-8-7.49a4.67 4.67 0 00-1.53-1.47 1.66 1.66 0 00-2 .16 2.06 2.06 0 00-.45 1.13c-.78 5 2.17 12.93 8.6 17.3 3.82 2.61 5.91 1.11 9.51 4"
        fill="#e45055"
      />
      <path
        d="M56.74 94.59c.39-3-1.68-5.69-4-7.55s-5.08-3.24-7-5.52a3.34 3.34 0 00-.88-.84.94.94 0 00-1.13.09 1.25 1.25 0 00-.26.65 10.85 10.85 0 005.72 11.4c2.38 1.16 5.21 1.45 7.27 3.11"
        fill="#e8828b"
      />
      <path
        d="M55.66 95.36A32.65 32.65 0 0181 70.27c-3.54 4.32-6.16 9.32-9.45 13.83S64 92.77 58.65 94.35"
        fill="#e45055"
      />
      <path
        d="M55.67 95.4C57.11 88.15 66 74.54 73.22 73.17 71.14 75.7 66.9 86.15 65 88.8s-4.4 5.08-7.54 6"
        fill="#e8828b"
      />
      <path
        d="M56.74 94.77c3-1.1 6-2.42 9.2-2.42a11.7 11.7 0 014.79 1.11C74.45 95 76 96.54 79.14 99c-2.29-.24-4.49.77-6.71 1.41-7.37 2.12-7.42 2.78-12.76-2.72"
        fill="#e45055"
      />
      <path
        d="M58 95.31a12.93 12.93 0 012.83 4.39 60.53 60.53 0 011.41 7.3 25.39 25.39 0 010 5.58 9.75 9.75 0 01-5.72-4.05c-1.29-2-3.22-8.6-2.35-10.83"
        fill="#e45055"
      />
      <path
        d="M58.41 94.76a5.64 5.64 0 011.26 1.95 26.67 26.67 0 01.63 3.29 11.42 11.42 0 010 2.48 4.31 4.31 0 01-2.55-1.8c-.57-.9-1.43-3.84-1-4.83"
        fill="#e8828b"
      />
      <path
        d="M54.66 94.87c-4.57-1.63-9.65.63-13.41 3.69s-2.3 4.61-6.43 7.18c4.79.61 5.13 1.57 9.37-.74a69.36 69.36 0 0011.62-8.59"
        fill="#e45055"
      />
      <path
        d="M56.62 95.06c-2.11-.76-4.46.28-6.2 1.7s-3.17 3.24-5.08 4.42a10.76 10.76 0 006.44-1.44 31.84 31.84 0 005.37-4"
        fill="#e8828b"
      />
      <path
        d="M55.82 93.2c.56 0 1.1-.15 1.66-.17a2.23 2.23 0 011.57.45.91.91 0 01.25.3 1 1 0 010 .75 1.81 1.81 0 01-.91 1 5.24 5.24 0 01-1.29.41l-.73.16a2 2 0 01-.73.06 1.26 1.26 0 01-.87-1.56 2.4 2.4 0 011.31-1.43"
        fill="#9d2125"
      />
    </>,
  ],
  [
    <>
      <path
        d="M56.89 93.44c-1.67-4.93 1-10.32 4.32-14.29s7.62-7.28 10.14-11.84a5.94 5.94 0 011.22-1.74 1.67 1.67 0 012-.22 2.21 2.21 0 01.66 1 19 19 0 01-5.94 21.47c-3.68 2.81-8.43 4.25-11.39 7.8"
        fill="#9d2125"
      />
      <path d="M58.28 95a32.65 32.65 0 00-29.71-19.7c4.31 3.55 7.85 7.94 12 11.73s9.06 7 14.62 7.56" fill="#9d2125" />
      <path
        d="M57.1 94.62a33 33 0 00-9.49-.6 22.43 22.43 0 00-10.86 5 67 67 0 00-8.49 8.6c2.21-.68 4.57-.11 6.86.08a21.75 21.75 0 0019.68-9.64"
        fill="#9d2125"
      />
      <path
        d="M56 95.39a12.62 12.62 0 00-1.92 4.85 58.87 58.87 0 000 7.4 25.48 25.48 0 001.08 5.47A9.79 9.79 0 0060 108c.87-2.23 1.49-9 .2-11.07"
        fill="#9d2125"
      />
      <path
        d="M59.16 94.31c4.16-2.49 9.59-1.26 13.87 1s8.07 5.53 12.61 7.24c-4.58 1.53-9.63 1.08-14.24-.35A69.67 69.67 0 0158.33 96"
        fill="#9d2125"
      />
      <path
        d="M57.7 92.9c-.55.08-1.11.06-1.66.15a2.25 2.25 0 00-1.46.74.9.9 0 00-.18.35 1 1 0 00.13.73 1.82 1.82 0 001.08.77 6.14 6.14 0 001.35.15h.74a1.86 1.86 0 00.74-.08A1.25 1.25 0 0059 94a2.41 2.41 0 00-1.57-1.16"
        fill="#e45055"
      />
    </>,
  ],
  [
    <>
      <path
        d="M5 16.63a9 9 0 01-2-5.07 3.61 3.61 0 01.41-2.25 2.91 2.91 0 012-1.22 5.14 5.14 0 013.73 1 10.85 10.85 0 012.61 3 26.54 26.54 0 012.82 5.7"
        fill="#e45055"
      />
      <path
        d="M10.39 12.8A9.75 9.75 0 018 7.32a3.71 3.71 0 01.43-2.41 3.22 3.22 0 012.24-1.27 6 6 0 014.22 1.14 12.15 12.15 0 013 3.2 28.31 28.31 0 013.25 6.15"
        fill="#e45055"
      />
      <path
        d="M15.84 8.2c-.33-1.31-.63-2.77 0-3.95a4 4 0 012.63-1.67 3.92 3.92 0 012.15.06 3.63 3.63 0 011.38.94 7.33 7.33 0 011.77 4.56 21.81 21.81 0 01-.44 5"
        fill="#e45055"
      />
      <path
        d="M17.08 8.71a3.26 3.26 0 00-1.78-1.92 3.75 3.75 0 00-2.49.3 4.58 4.58 0 00-1.8 1c-1 1-1.14 2.6-1.21 4 0 0 .32 5.75 2.52 8.36s4.68-.81 4.68-.81.47-9.35.08-10.93z"
        fill="#e8828b"
      />
      <path
        d="M16.87 26.26c-3.22-.93-7.42-2.78-9.9-5.11a10.35 10.35 0 01-3.13-4.8A6.2 6.2 0 015 10.73a5.14 5.14 0 015.16-1.38 7.55 7.55 0 014.22 3.52 16.3 16.3 0 011.86 5.45 34.31 34.31 0 01.55 7.16"
        fill="#e45055"
      />
      <path
        d="M14.57 17.25A14.77 14.77 0 0116.33 7a4.17 4.17 0 011.44-1.59 3.51 3.51 0 013.23.27 8 8 0 013.62 4.49 16.06 16.06 0 01.74 5.83 8.86 8.86 0 01-.72 3.68 8.42 8.42 0 01-1.86 2.26c-2.08 1.91-3.24 3.13-5.88 4.14"
        fill="#e45055"
      />
      <path
        d="M24.26 32.5c-3.83-2-7.7-4.09-10.89-7a8.13 8.13 0 01-2.06-2.58c-.4-.89-.42-2.12.4-2.63a1.88 1.88 0 011.34-.19 4.85 4.85 0 012.5 1.44 3.3 3.3 0 01.24-1.21 1.21 1.21 0 01.94-.73 1.54 1.54 0 01.75.21 5 5 0 012.25 2.42A5.31 5.31 0 0121 19.58a2.4 2.4 0 012.68-.58 3 3 0 011.07 1.12 10.87 10.87 0 011.41 5.79 43.19 43.19 0 01-.65 6c-.05.39-.11.78-.16 1.18"
        fill="#844439"
      />
      <path
        d="M22.83 30c3.19 3.31 4.79 7.64 6.29 11.9q2.47 7 5.34 13.82a193.3 193.3 0 0012.93 25.63 133.88 133.88 0 009.08 13.09c.22.29.63-.12.4-.41C44.73 78.6 36.25 60.39 29.74 42c-1.55-4.46-3.19-9-6.51-12.4-.25-.26-.66.14-.4.41z"
        fill="#844439"
      />
    </>,
  ],
  [
    <>
      <path
        d="M56.81 94.26c.16-8.84 3.71-17 6.86-25.09 3.3-8.45 6.58-17 8.65-25.84a76.15 76.15 0 002-15.18c0-.22-.34-.22-.35 0-.25 9.32-2.56 18.39-5.56 27.18-2.87 8.38-6.53 16.47-9.32 24.88a47.5 47.5 0 00-2.67 14.05.18.18 0 00.35 0z"
        fill="#c03f4b"
      />
      <path
        d="M73.56 33.67a122.61 122.61 0 01-.92-15.56 33.94 33.94 0 01.28-4.94 27.94 27.94 0 016-12.84 13.9 13.9 0 012 5.88 22.85 22.85 0 01-.52 6.69A68.3 68.3 0 0177 24.69 22.76 22.76 0 0178.61 22c2.57-3.3 3.75-3.84 7.53-5.44 1.08 2.43.08 5.26-1.21 7.58a32.31 32.31 0 01-11 11.64M69.58 52.93a13.64 13.64 0 01-5.7-6.29 24.91 24.91 0 01-2-8.68 8.59 8.59 0 01.06-2.32.54.54 0 01.16-.35c.17-.13.42 0 .61.07A15.76 15.76 0 0169.16 42a13.41 13.41 0 011.43 8.41M64.42 67.15A5.5 5.5 0 0167 64.23c1-.68 2-1.38 2.94-2 2.23-1.48 4.56-2.76 6.88-4.07A26.85 26.85 0 0082.64 54a34.89 34.89 0 004.65-6.22c.12-.19-.18-.36-.3-.17a31.51 31.51 0 01-5.18 6.7 36.67 36.67 0 01-7 4.52A73.42 73.42 0 0068 63.08c-1.5 1.07-3.43 2.06-3.92 4-.06.21.28.31.33.09z"
        fill="#c03f4b"
      />
      <path
        d="M77.16 57.58a20 20 0 011.34-9.52 15.46 15.46 0 016-7.12c1.15 5.3-2.57 13-6.87 16.33M85.28 49.92a13.58 13.58 0 015.88-6.56 22.74 22.74 0 018.52-2.7c-.36 3.67-2.93 6.84-6.05 8.8a32.12 32.12 0 01-10.4 3.68M72 44.8c.39-2.18-.74-4-1.83-5.77a80.25 80.25 0 00-4.62-6.64 33.11 33.11 0 01-3.92-6.16 31.13 31.13 0 01-2-8.25c0-.21-.37-.12-.33.1a36 36 0 001.61 7.26 24.59 24.59 0 003.33 5.83c1.41 1.94 2.9 3.82 4.23 5.82 1.46 2.18 3.71 4.93 3.22 7.71 0 .22.29.32.33.1z"
        fill="#c03f4b"
      />
      <path
        d="M64.54 31.13a19.7 19.7 0 002.64-9.24 15.28 15.28 0 00-2.61-9c-3.21 4.39-2.94 12.94-.36 17.71M60.23 20.85a13.48 13.48 0 00-2.71-8.37 22.58 22.58 0 00-6.69-5.91c-1.16 3.5-.1 7.44 2 10.49s5 5.39 8 7.56M64.19 67.36c-2.52-3.32-4.64-6.9-5.1-11.12 0-.22-.37-.22-.34 0 .46 4.29 2.58 7.92 5.14 11.29.13.18.43 0 .3-.17z"
        fill="#c03f4b"
      />
      <path
        d="M59.31 56.15a15.17 15.17 0 00-2.5-8.37 22.58 22.58 0 00-6.69-5.91c-1.16 3.5-.1 7.43 2 10.49s5.37 4 7.05 5.44"
        fill="#c03f4b"
      />
    </>,
  ],
  [
    <>
      <path
        d="M56.9 94.88c.16-8.83 3.72-17 6.86-25.07C67 61.41 70.25 53 72.27 44.16a74.27 74.27 0 002-14.83c0-.22-.33-.22-.34 0-.25 9.24-2.53 18.23-5.5 26.94-2.86 8.31-6.43 16.34-9.23 24.67a47.07 47.07 0 00-2.64 13.94c0 .22.33.22.34 0z"
        fill="#c03f4b"
      />
      <path
        d="M73.53 33.53a124.31 124.31 0 01-.91-15.43 34.84 34.84 0 01.29-4.9A27.54 27.54 0 0178.84.47a13.91 13.91 0 012 5.84 22.72 22.72 0 01-.52 6.62 66.36 66.36 0 01-3.4 11.7 22.4 22.4 0 011.62-2.71c2.54-3.27 3.7-3.81 7.44-5.39 1.06 2.4.07 5.21-1.2 7.51a32.05 32.05 0 01-10.9 11.54M69.61 52.63A13.55 13.55 0 0164 46.39a24.89 24.89 0 01-2-8.6 8.84 8.84 0 01.05-2.3.56.56 0 01.17-.35c.17-.13.41 0 .6.07a15.53 15.53 0 016.39 6.55 13.34 13.34 0 011.39 8.34M65 66.88c.64-2.61 3.54-4.16 5.63-5.53s4.42-2.6 6.64-3.89a24.71 24.71 0 005.51-4.07 36 36 0 004.33-5.91c.12-.18-.18-.35-.29-.17A32.66 32.66 0 0182 53.69a31.61 31.61 0 01-6.55 4.41 76.64 76.64 0 00-6.7 4.12c-1.69 1.18-3.55 2.45-4.07 4.57 0 .21.28.3.33.09z"
        fill="#c03f4b"
      />
      <path
        d="M77.09 57.24a19.77 19.77 0 011.33-9.44 15.27 15.27 0 016-7.06c1.13 5.26-2.54 12.9-6.79 16.2M85.12 49.65a13.42 13.42 0 015.81-6.51 22.41 22.41 0 018.42-2.68c-.36 3.64-2.9 6.78-6 8.73s-6.7 2.87-10.27 3.64"
        fill="#c03f4b"
      />
    </>,
  ],
];

const RotateLeaf = styled.g<{index: number; angle: number; gap: number; timing: number; isVisible: boolean}>`
  @keyframes rotateLeaf${(props) => props.index} {
    from {
      transform: rotate(${(props) => props.angle}deg);
    }
    to {
      transform: rotate(${(props) => props.angle + props.gap}deg);
    }
  }
  animation: ${(props) => props.timing}s ease-in-out 0.5s infinite alternate ${(props) => `rotateLeaf${props.index}`};

  transform: rotate(${(props) => (props.isVisible ? props.angle : 0)}deg);
  transition: transform 2s ease-in-out;
  transform-origin: 50px 95px;
`;

const ScaleLeaf = styled.g<{index: number; scale: number; timing: number; isVisible: boolean}>`
  transform: scale(${(props) => (props.isVisible ? props.scale : 0)});
  transition: transform ${Math.floor(Math.random() * 10)}s ease-in-out;
  transition-delay: ${(props) => Math.floor(Math.random() * props.index + 2)}s;
  transform-origin: 50px 95px;
`;

const TranslateLeaf = styled.svg<{point: Point; scale: number}>`
  position: absolute;
  overflow: visible;
  transform: translate(${(props) => props.point.x - 50}px, ${(props) => props.point.y - 95}px);
`;

type LeafProps = {
  point: Point;
  size: Size;
};

const Leaf = ({point, size}: LeafProps) => {
  const [isVisible, display] = useState(false);

  useEffect(() => {
    const timer = setTimeout(() => {
      display(true);
    }, 500);

    return () => clearTimeout(timer);
  }, []);

  return (
    <TranslateLeaf
      width={100}
      height={100}
      viewBox="0 0 100 100"
      point={point}
      scale={point.scale}
      key={point.x + point.y + point.index}
    >
      <ScaleLeaf isVisible={isVisible} index={point.index} scale={point.scale} timing={point.timing}>
        <RotateLeaf isVisible={isVisible} index={point.index} angle={point.angle} timing={point.timing} gap={point.gap}>
          {bouquets[Math.floor(Math.random() * bouquets.length)][0]}
        </RotateLeaf>
      </ScaleLeaf>
    </TranslateLeaf>
  );
};

type LeafCollectionProps = {
  size: Size;
  leafPoints: Point[];
};

const LeafCollection = ({size, leafPoints}: LeafCollectionProps) => {
  return (
    <Board size={size}>
      {leafPoints.map((point, index) => (
        <Leaf key={point.index} point={point} size={size} />
      ))}
    </Board>
  );
};

export {LeafCollection};
